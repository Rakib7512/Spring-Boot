<div class="container my-5 px-4 py-4 rounded shadow bg-white">

  <h3 class="text-center text-primary mb-4 fw-bold">
    <i class="bi bi-box-seam-fill me-2"></i> Add New Parcel
  </h3>

  <div class="row g-4">

    <!-- Sender Information -->
    <div class="col-md-6">
      <div class="card border border-primary shadow-sm h-100">
        <div class="card-header bg-primary text-white fw-semibold">
          <i class="bi bi-person-fill me-1"></i> Sender Information
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Sender Name</label>
            <input [(ngModel)]="senderName" name="senderName" class="form-control" placeholder="Full name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Sender Phone</label>
            <input [(ngModel)]="senderPhone" name="senderPhone" class="form-control" placeholder="Phone number" required>
          </div>

          <!-- Location Selects -->
          <ng-container *ngIf="countries">
            <div class="mb-2">
              <label class="form-label">Country</label>
              <select class="form-select" [(ngModel)]="selectedSendCountry" (change)="onSendCountryChange()">
                <option value="">-- Select Country --</option>
                <option *ngFor="let c of countries" [value]="c.id">{{ c.name }}</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Division</label>
              <select class="form-select" [(ngModel)]="selectedSendDivision" (change)="onSendDivisionChange()">
                <option value="">-- Select Division --</option>
                <option *ngFor="let d of divisions" [value]="d.id">{{ d.name }}</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">District</label>
              <select class="form-select" [(ngModel)]="selectedSendDistrict" (change)="onSendDistrictChange()">
                <option value="">-- Select District --</option>
                <option *ngFor="let d of districts" [value]="d.id">{{ d.name }}</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Police Station</label>
              <select class="form-select" [(ngModel)]="selectedSendPoliceStation">
                <option value="">-- Select Police Station --</option>
                <option *ngFor="let ps of policeStations" [value]="ps.id">{{ ps.name }}</option>
              </select>
            </div>
          </ng-container>

          <div class="mt-3">
            <label class="form-label">Address Line 1</label>
            <input type="text" class="form-control mb-2" [(ngModel)]="addressLineForSender1">
            <label class="form-label">Address Line 2</label>
            <input type="text" class="form-control" [(ngModel)]="addressLineForSender2">
          </div>
        </div>
      </div>
    </div>

    <!-- Receiver Information -->
    <div class="col-md-6">
      <div class="card border border-success shadow-sm h-100">
        <div class="card-header bg-success text-white fw-semibold">
          <i class="bi bi-person-fill-check me-1"></i> Receiver Information
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Receiver Name</label>
            <input [(ngModel)]="receiverName" name="receiverName" class="form-control" placeholder="Full name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Receiver Phone</label>
            <input [(ngModel)]="receiverPhone" name="receiverPhone" class="form-control" placeholder="Phone number" required>
          </div>

          <!-- Location Selects -->
          <div class="mb-2">
            <label class="form-label">Country</label>
            <select class="form-select" [(ngModel)]="selectedReceiveCountry" (change)="onReceiveCountryChange()">
              <option value="">-- Select Country --</option>
              <option *ngFor="let c of receiverCountries" [value]="c.id">{{ c.name }}</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Division</label>
            <select class="form-select" [(ngModel)]="selectedReceiveDivision" (change)="onReceiveDivisionChange()">
              <option value="">-- Select Division --</option>
              <option *ngFor="let d of receiverDivisions" [value]="d.id">{{ d.name }}</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">District</label>
            <select class="form-select" [(ngModel)]="selectedReceiveDistrict" (change)="onReceiveDistrictChange()">
              <option value="">-- Select District --</option>
              <option *ngFor="let d of receiverDistricts" [value]="d.id">{{ d.name }}</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Police Station</label>
            <select class="form-select" [(ngModel)]="selectedReceivePoliceStation">
              <option value="">-- Select Police Station --</option>
              <option *ngFor="let ps of receiverPoliceStations" [value]="ps.id">{{ ps.name }}</option>
            </select>
          </div>

          <div class="mt-3">
            <label class="form-label">Address Line 1</label>
            <input type="text" class="form-control mb-2" [(ngModel)]="addressLineForReceiver1">
            <label class="form-label">Address Line 2</label>
            <input type="text" class="form-control" [(ngModel)]="addressLineForReceiver2">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Parcel Details -->
  <div class="card border-info shadow-sm mb-4">
    <div class="card-header bg-info text-white fw-semibold">
      <i class="bi bi-info-circle-fill me-1"></i> Parcel Details
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Parcel Size</label>
          <select [(ngModel)]="size" name="size" class="form-select" (change)="calculateParcelFee()" required>
            <option value="">-- Select Size --</option>
            <option value="SMALL">Small</option>
            <option value="MEDIUM">Medium</option>
            <option value="LARGE">Large</option>
            <option value="EXTRA_LARGE">Extra Large</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Parcel Fee (à§³)</label>
          <input type="number" [(ngModel)]="fee" name="fee" class="form-control" readonly>
        </div>
      </div>

      <!-- Payment -->
      <div class="mt-3">
        <label class="form-label">Payment Method</label>
        <select class="form-select" [(ngModel)]="paymentMethod" (change)="updatePaymentDetails()">
          <option value="">Select Payment Method</option>
          <option value="bkash">Bkash</option>
          <option value="nagad">Nagad</option>
          <option value="bank">Bank</option>
        </select>
      </div>

      <div class="mt-3" *ngIf="paymentInfo">
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-1"></i> {{ paymentInfo }}
        </div>
      </div>

      <div class="d-grid mt-3">
        <button class="btn btn-outline-primary" (click)="startPayment()">
          <i class="bi bi-cash-stack me-1"></i> Proceed to Payment
        </button>
      </div>

      <div class="alert alert-success mt-4" *ngIf="trackingId && paymentSuccess">
        <h6><i class="bi bi-truck me-1"></i> Your Parcel Tracking ID:</h6>
        <strong>{{ trackingId }}</strong><br />
        Please include this ID in your payment confirmation.
      </div>

      <div class="mt-3" *ngIf="paymentSuccess">
        <label class="form-label">Enter Payment Confirmation Code:</label>
        <input type="text" class="form-control" [(ngModel)]="enteredConfirmationCode" placeholder="Enter confirmation code">
      </div>
    </div>
  </div>

  <!-- Submit Button -->
  <div class="d-grid">
    <button type="button" class="btn btn-success btn-lg" (click)="submitParcel()">
      <i class="bi bi-send-check-fill me-1"></i> Submit Parcel
    </button>
  </div>
</div>
